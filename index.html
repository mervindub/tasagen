</html>
<head>
  <title>Generar imagen</title>
  <style type="text/css">
    @font-face {
      font-family: "OpenSansLight";
      src: url("font.ttf");  }
</style>
  </style>
</head>
<body>
<div style="font-family: 'OpenSansLight';">

  <input type="file" id="loader" accept="image/jpeg">
  <input type="number" id="tasa" placeholder="Tasa actual" value="0.114">
  <button onclick="download()">Generar</button>

<canvas id="canvas" style="display: none"></canvas>

<script>
  const loader = document.getElementById('loader');
  const canvas = document.getElementById('canvas');

  const month = [
    'enero', 'febrero', 'marzo',
    'abril', 'mayo', 'junio',
    'julio', 'agosto', 'septiembre',
    'octubre', 'noviembre', 'diciembre'
  ];
  const values = [20000, 30000, 40000, 50000, 60000, 70000, 80000, 90000, 100000, 150000, 200000, 300000];

  var ctx = canvas.getContext('2d');
  var img = new Image();
  img.crossOrigin="anonymous";
  loader.addEventListener('change', handleImage, false);


  function handleImage(e) {
    var reader = new FileReader();
    var img = "";
    var src = "";
    reader.onload = function(event) {
      img = new Image();
      img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);
      }
      img.src = event.target.result;
      src = event.target.result;
    }

    reader.readAsDataURL(e.target.files[0]); 
  }

  function download() {
    const tasa = parseFloat(document.getElementById('tasa').value);

    //Tasa
    ctx.textAlign = "center";
    ctx.font = "80px OpenSansLight";
    ctx.fillStyle = "#00ffc0";
    ctx.fillText(String(tasa).replace('.',','), 615, 295);

    //Fecha
    const dt = new Date();
    const fecha = dt.getUTCDate() + " / " + month[dt.getUTCMonth()].toUpperCase() + " / " + dt.getFullYear();
    ctx.fillStyle = "white";
    ctx.font = "70px OpenSansLight";
    ctx.fillText(fecha, 385, 385);

    //Cambios
    ctx.textAlign = "left";
    ctx.font = "55px OpenSansLight";
    var y = 500;
    values.forEach(v => {
      ctx.fillText("Bs. " + Number(parseInt(v / tasa)).toLocaleString(), 340, y);
      y += 60;
    });

    document.querySelector('html').innerHTML = '\
      <style>html { background: #333; } img { height: 100%; }</style>\
      <img src="' + canvas.toDataURL("image/jpeg") + '">';
  }

</script>

</body>
</html>

